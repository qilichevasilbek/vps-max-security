name: ShellCheck

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install ShellCheck
        run: sudo apt-get install -y shellcheck

      - name: Lint all shell scripts
        run: |
          set -euo pipefail
          failed=0
          while IFS= read -r -d '' file; do
            if ! shellcheck -x -S warning "$file"; then
              failed=1
            fi
          done < <(find . -name '*.sh' -type f -print0)
          if ! shellcheck -x -S warning ./vps-max-security; then
            failed=1
          fi
          exit "$failed"
